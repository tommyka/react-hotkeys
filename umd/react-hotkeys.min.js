/**
 * ISC License
 *
 * Copyright (c) 2018, Aleck Greenham
 *
 * Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("prop-types"),require("react")):"function"==typeof define&&define.amd?define(["exports","prop-types","react"],t):t((e=e||self).ReactHotkeys={},e.PropTypes,e.React)}(this,function(e,n,r){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var a="default"in r?r.default:r;function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(e){s(t,e,n[e])})}return t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t,n){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&v(o,n.prototype),o}).apply(null,arguments)}function f(e){var i="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,n)}function n(){return o(e,arguments,d(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),v(n,e)})(e)}function p(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?g(e):t}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function _(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(e){return Array.isArray(e)?e:e?[e]:[]}function E(e){return e}function K(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:E,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o="function"==typeof t?t:function(){return t};return b(e).reduce(function(e,t){return e[n(t)]=o(t),e},i)}var C=function(t){return Object.keys(t).map(function(e){return t[e]})},S={logLevel:"warn",defaultKeyEvent:"keydown",defaultComponent:"div",defaultTabIndex:"-1",ignoreTags:["input","select","textarea"],ignoreKeymapAndHandlerChangesByDefault:!0,ignoreEventsCondition:function(e){var t=e.target;if(t&&t.tagName){var n=t.tagName.toLowerCase();return w.option("_ignoreTagsDict")[n]||t.isContentEditable}return!1},ignoreRepeatedEventsWhenKeyHeldDown:!0,simulateMissingKeyPressEvents:!0,stopEventPropagationAfterHandling:!0,stopEventPropagationAfterIgnoring:!0,allowCombinationSubmatches:!1,customKeyCodes:{}},I=h({},S);I._ignoreTagsDict=K(I.ignoreTags);var w=function(){function e(){u(this,e)}return l(e,null,[{key:"init",value:function(t){var n=this,e=t.ignoreTags,i=t.customKeyCodes;e&&(t._ignoreTagsDict=K(t.ignoreTags)),i&&(t._customKeyNamesDict=K(C(t.customKeyCodes))),-1!==["verbose","debug","info"].indexOf(t.logLevel)&&console.warn("React HotKeys: You have requested log level '".concat(t.logLevel,"' but for performance reasons, logging below severity level 'warning' is disabled in production. Please use the development build for complete logs.")),Object.keys(t).forEach(function(e){n.set(e,t[e])})}},{key:"set",value:function(e,t){I[e]=t}},{key:"reset",value:function(e){I[e]=S[e]}},{key:"option",value:function(e){return I[e]}}]),e}();function P(e,t){var n=t.deprecatedAPI,i=n.contextTypes,o=n.childContextTypes,r=t.newAPI.contextType;if(void 0===a.createContext)e.contextTypes=i,e.childContextTypes=o,e.prototype.getChildContext=function(){return this._manager.childContext};else{var s=a.createContext(r);e.contextType=s,e.prototype._originalRender=e.prototype.render,e.prototype.render=function(){var e=this._originalRender();return e?a.createElement(s.Provider,{value:this._manager.childContext},e):null}}return e}function H(e){return void 0===e}var T=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"warn";u(this,o),s(this,"verbose",this.noop),s(this,"debug",this.noop),s(this,"info",this.noop),s(this,"warn",this.noop),s(this,"error",this.noop),this.logLevel=this.constructor.levels[e];for(var t=["error","warn","info","debug","verbose"],n=0;n<t.length;n++){var i=t[n];if(this.logLevel<this.constructor.levels[i])return;this[i]=-1===["debug","verbose"].indexOf(i)?console[i]:console.log}}return l(o,[{key:"noop",value:function(){}}]),o}();s(T,"logIcons",["ðŸ“•","ðŸ“—","ðŸ“˜","ðŸ“™"]),s(T,"componentIcons",["ðŸ”º","â­ï¸","ðŸ”·","ðŸ”¶","â¬›ï¸"]),s(T,"eventIcons",["â¤ï¸","ðŸ’š","ðŸ’™","ðŸ’›","ðŸ’œ","ðŸ§¡"]),s(T,"levels",{none:0,error:1,warn:2,info:3,debug:4,verbose:5});var M={keydown:0,keypress:1,keyup:2},O=0,A=1,L={"`":["~"],1:["!"],2:["@",'"'],3:["#","Â£"],4:["$"],5:["%"],6:["^"],7:["&"],8:["*"],9:["("],0:[")"],"-":["_"],"=":["plus"],";":[":"],"'":['"',"@"],",":["<"],".":[">"],"/":["?"],"\\":["|"],"[":["{"],"]":["}"],"#":["~"]};function x(e,t,n){return e[t]||[1===t.length?t[n]():t]}function F(e){return x(L,e,"toUpperCase")}function D(e,t){return e.hasOwnProperty(t)}function R(i){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(i).reduce(function(t,n){var e=i[n];return e.forEach(function(e){D(t,e)||(t[e]=[]),t[e].push(n)}),o.includeOriginal&&(D(t,n)||(t[n]=[]),t[n]=[].concat(_(t[n]),_(e))),t},{})}var N=R(L);function j(e){return x(N,e,"toLowerCase")}var q=R({},{includeOriginal:!0});function B(e){return"string"==typeof e}var U={tab:"Tab",capslock:"CapsLock",shift:"Shift",meta:"Meta",alt:"Alt",ctrl:"Control",space:" ",spacebar:" ",escape:"Escape",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",return:"Enter",del:"Delete",command:"Meta",option:"Alt",enter:"Enter",backspace:"Backspace",ins:"Insert",pageup:"PageUp",pagedown:"PageDown",end:"End",home:"Home",contextmenu:"ContextMenu",numlock:"Clear"},z={cmd:"Meta"},W={"`":["`"],1:["â„"],2:["â‚¬"],3:["â€¹"],4:["â€º"],5:["ï¬"],6:["ï¬‚"],7:["â€¡"],8:["Â°"],9:["Â·"],0:["â€š"],"-":["â€”"],"=":["Â±"],a:["Ã…"],b:["Ä±"],c:["Ã‡"],d:["ÃŽ"],e:["Â´"],f:["Ã"],g:["Ë"],h:["Ã“"],i:["Ë†"],j:["Ã”"],k:["ï£¿"],l:["Ã’"],m:["Ã‚"],n:["Ëœ"],o:["Ã˜"],p:["Ï€"],q:["Å’"],r:["â€°"],s:["Ã"],t:["ÃŽ"],u:["Â¨"],v:["â—Š"],w:["â€ž"],x:["Ë›"],y:["Ã"],z:["Â¸"],"[":["â€"],"]":["â€™"],"\\":["Â»"],"'":["Ã†"],";":["Ãš"],",":["Â¯"],".":["Ë˜"]},G=R(W);function J(e){return G[e]||j(e)}function V(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shift:!1,alt:!1},n=e.toLowerCase(),i=U[n]||z[n]||(e.match(/^f\d+$/)?e.toUpperCase():e);return t.shift?t.alt?J(i):j(i):i}var $={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Y=K(C($));function Q(e){return!!Y[e]}function X(e){return Q(e)||String.fromCharCode(e.charCodeAt(0))===e||(t=e,w.option("_customKeyNamesDict")[t]);var t}var Z=function(e){function r(){var e,t;u(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return s(g(g(t=m(this,(e=d(r)).call.apply(e,[this].concat(i))))),"name","InvalidKeyNameError"),t}return y(r,f(Error)),r}();function ee(e){return Object.keys(e).sort(function(e,t){return e.length!==t.length?t.length-e.length:e<t?-1:t<e?1:0}).join("+")}var te=function(){function e(){u(this,e)}return l(e,null,[{key:"parse",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(B(t=e)?t.trim().replace(/\s+/g," "):t).split(" ");try{var o=i.slice(0,i.length-1),r=i[i.length-1],s=o.map(function(e){return ee(ne(e,n))}).join(" "),a=ne(r,n),u={id:ee(a),keyDictionary:a,keyEventType:n.keyEventType,size:Object.keys(a).length};return{sequence:{prefix:s,size:o.length+1},combination:u}}catch(e){return{sequence:null,combination:null}}}}]),e}();function ne(e){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=-1!==e.indexOf(/[sS]hift/),r=-1!==e.indexOf(/[sS]hift/);return e.replace(/^\+|(\s|[^+]\+)\+/,"$1plus").split("+").reduce(function(e,t){var n=V(t,{shift:o,alt:r});if(i.ensureValidKeys&&!X(n))throw new Z;return e[n]=!0,e},{})}var ie={"`":["`"],1:["Â¡"],2:["â„¢"],3:["Â£"],4:["Â¢"],5:["âˆž"],6:["Â§"],7:["Â¶"],8:["â€¢"],9:["Âª"],0:["Âº"],"-":["â€“"],"=":["â‰ "],a:["Ã¥"],b:["âˆ«"],c:["Ã§"],d:["âˆ‚"],e:["Â´"],f:["Æ’"],g:["Â©"],h:["Ë™"],i:["Ë†"],j:["âˆ†"],k:["Ëš"],l:["Â¬"],m:["Âµ"],n:["Ëœ"],o:["Ã¸"],p:["Ï€"],q:["Å“"],r:["Â®"],s:["ÃŸ"],t:["â€ "],u:["Â¨"],v:["âˆš"],w:["âˆ‘"],x:["â‰ˆ"],y:["Â¥"],z:["Î©"],"[":["â€œ"],"]":["â€˜"],"\\":["Â«"],"'":["Ã¦"],";":["â€¦"],",":["â‰¤"],".":["â‰¥"],"/":["Ã·"]},oe=R(ie);function re(e){return oe[e]||[e]}function se(e){return ie[e]||[e]}function ae(e){return W[e]||[e]}function ue(e){return!Array.isArray(e)&&"object"===t(e)&&null!==e}function ce(e){return ue(e)?Object.keys(e).length:e.length}function le(e,t){var n,i,o,r,s,a=e.Shift,u=e.Alt,c=a?(r=t,u?[].concat(_(ae(r)),_(J(r)),[r]):[].concat(_(F(r)),_(j(r)),[r])):u?[].concat(_(se(o=t)),_(re(o)),[o]):(i=q[n=t])?[n].concat(_(i)):[n];return s=c,Object.keys(K(s))}var he=function(){function e(){u(this,e)}return l(e,null,[{key:"serialize",value:function(e){var i;return(i=e,Object.keys(i).reduce(function(n,e){var t=le(i,e);return 0===ce(n)?t.map(function(e){return s({},e,!0)}):t.reduce(function(e,t){return e.concat(n.map(function(e){return h({},e,s({},t,!0))}))},[])},[])).map(ee)}},{key:"isValidKeySerialization",value:function(e){return 0<e.length&&!!te.parse(e,{ensureValidKeys:!0}).combination}}]),e}();function ye(e){return[e]}var de=0,ve=1,fe=2,pe=function(){function e(){u(this,e)}return l(e,null,[{key:"newRecord",value:function(e,t){var n=[de,de,de];if(!H(e))for(var i=0;i<=e;i++)n[i]=t;return n}},{key:"setBit",value:function(e,t,n){return e[t]=n,e}},{key:"clone",value:function(e){for(var t=this.newRecord(),n=0;n<e.length;n++)t[n]=e[n];return t}}]),e}();function ge(e){return ue(e)?0===Object.keys(e).length:!e||0===e.length}function me(e,t,n){return e[t]||(e[t]="function"==typeof n?n():n),e[t]}var ke={Shift:["shiftKey"],Meta:["metaKey"],Control:["ctrlKey"],Alt:["altKey"]};function _e(e){return e.simulated?fe:ve}var be=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.keyStates=e,this.isEnding=!1,this._keyAliases=void 0,this._ids=void 0}return l(t,[{key:"getNormalizedKeyName",value:function(e){if(this.keyStates[e])return e;var t=this.keyAliases[e];return t||e}},{key:"hasEnded",value:function(){return ge(this.keysStillPressedDict())}},{key:"addKey",value:function(e,t){this._setKeyState(e,[pe.newRecord(),pe.newRecord(M.keydown,t)])}},{key:"setKeyState",value:function(e,t,n){var i=this._getKeyState(e);if(this.isKeyIncluded(e)){var o=pe.clone(i[1]),r=pe.clone(o);pe.setBit(r,t,n),this._setKeyState(e,[o,r])}else this.addKey(e,n);t===M.keyup&&(this.isEnding=!0)}},{key:"keysStillPressedDict",value:function(){var n=this;return this.keys.reduce(function(e,t){return n.isKeyStillPressed(t)&&(e[t]=n._getKeyState(t)),e},{})}},{key:"isKeyIncluded",value:function(e){return!!this._getKeyState(e)}},{key:"isKeyStillPressed",value:function(e){return this.isEventTriggered(e,M.keypress)&&!this.isKeyReleased(e)}},{key:"isKeyReleased",value:function(e){return this.isEventTriggered(e,M.keyup)}},{key:"isEventTriggered",value:function(e,t){return this._getKeyStateType(e,A,t)}},{key:"wasEventPreviouslyTriggered",value:function(e,t){return this._getKeyStateType(e,O,t)}},{key:"isKeyPressSimulated",value:function(e){return this.isEventTriggered(e,M.keypress)===fe}},{key:"isKeyUpSimulated",value:function(e){return this.isEventTriggered(e,M.keyup)===fe}},{key:"resolveModifierFlagDiscrepancies",value:function(i,e,o){var r=this;Object.keys(ke).forEach(function(t){if(e!==t||o!==M.keyup){var n=r.isKeyStillPressed(t);ke[t].forEach(function(e){!1===i[e]&&n&&r.setKeyState(t,M.keyup,_e(i))})}})}},{key:"_getKeyStateType",value:function(e,t,n){var i=this._getKeyState(e);return i&&i[t][n]}},{key:"_getKeyState",value:function(e){var t=this.keyStates[e];if(t)return t;var n=this.keyAliases[e];return n?this.keyStates[n]:void 0}},{key:"_setKeyState",value:function(e,t){var n=this.getNormalizedKeyName(e);this.keyStates[n]=t,delete this._keyAliases,delete this._ids}},{key:"ids",get:function(){var e=this;return me(this,"_ids",function(){return he.serialize(e.keyStates)})}},{key:"keyAliases",get:function(){var e=this;return me(this,"_keyAliases",function(){return o=e.keyStates,Object.keys(o).reduce(function(n,i){var e;return(e=i,q[e]||[e]).forEach(function(t){var e;(e=o,e.Shift?e.Alt?[ae,J]:[F,j]:e.Alt?[se,re]:[ye,ye]).forEach(function(e){e(t).forEach(function(e){e===i&&i===t||(n[e]=i)})})}),n},{});var o})}},{key:"keys",get:function(){return Object.keys(this.keyStates)}}]),t}();var Ee=function(){function t(e){u(this,t),this._keyCombination=e}return l(t,[{key:"describe",value:function(){return this._keyCombination.ids[0]}},{key:"asKeyDictionary",value:function(){return K(this._keyCombination.keys)}},{key:"toJSON",value:function(){return{keys:this._keyCombination.keyStates,ids:this._keyCombination.ids,keyAliases:this._keyCombination.keyAliases}}}]),t}(),Ke=function(){function t(e){u(this,t),this._keyCombination=e}return l(t,[{key:"any",value:function(){return 0<this._getKeys().length}},{key:"forEachKey",value:function(e){return this._getKeys().forEach(e)}},{key:"some",value:function(e){return this._getKeys().some(e)}},{key:"_getKeys",value:function(){return this._keyCombination.keys}},{key:"numberOfKeys",get:function(){return ce(this._getKeys())}}]),t}(),Ce=function(){function i(e){var t=e.maxLength,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;u(this,i),this._combinations=[],this._maxLength=t,n?this._push(n):this._push(new be)}return l(i,[{key:"getPreviousCombinations",value:function(e){return this._combinations.slice(-(e+1),-1)}},{key:"any",value:function(){return this._combinations.some(function(e){return new Ke(e).any()})}},{key:"addKeyToCurrentCombination",value:function(e,t,n){this._ensureInitialKeyCombination(),this.currentCombination.setKeyState(e,t,n)}},{key:"startNewKeyCombination",value:function(e,t){this._ensureInitialKeyCombination();var n=new be(this.currentCombination.keysStillPressedDict());n.addKey(e,t),this._push(n)}},{key:"toJSON",value:function(){return this._combinations.map(function(e){return new Ee(e).toJSON()})}},{key:"_ensureInitialKeyCombination",value:function(){0===this.length&&this._push(new be)}},{key:"_push",value:function(e){this._trimHistory(),this._combinations.push(e)}},{key:"_trimHistory",value:function(){for(;this.length>this._maxLength;)this._shift()}},{key:"_shift",value:function(){this._combinations.shift()}},{key:"length",get:function(){return this._combinations.length}},{key:"currentCombination",get:function(){return this._combinations[this.length-1]}},{key:"maxLength",set:function(e){this._maxLength=e,this._trimHistory()}}]),i}(),Se=function(){function e(){u(this,e),this._registry={}}return l(e,[{key:"get",value:function(e){return this._registry[e]}},{key:"set",value:function(e,t){this._registry[e]=t}},{key:"remove",value:function(e){delete this._registry[e]}},{key:"toJSON",value:function(){return this._registry}}]),e}();var Ie=function(e){function i(){var e;return u(this,i),(e=m(this,d(i).call(this))).clearRootId(),e}return y(i,Se),l(i,[{key:"hasRoot",value:function(){return!this.isRootId(null)}},{key:"isRootId",value:function(e){return e===this.rootId}},{key:"clearRootId",value:function(){this.rootId=null}},{key:"add",value:function(e,t){k(d(i.prototype),"set",this).call(this,e,{childIds:[],parentId:null,keyMap:t})}},{key:"update",value:function(e,t){var n=k(d(i.prototype),"get",this).call(this,e);k(d(i.prototype),"set",this).call(this,e,h({},n,{keyMap:t}))}},{key:"setParent",value:function(e,t){H(t)?this.rootId=e:(this.get(e).parentId=t,this._addChildId(t,e))}},{key:"remove",value:function(e){var t=this._getParentId(e);this._removeChildId(t,e),k(d(i.prototype),"remove",this).call(this,e)}},{key:"_getParentId",value:function(e){var t=this.get(e);return t&&t.parentId}},{key:"_addChildId",value:function(e,t){this.get(e).childIds.push(t)}},{key:"_removeChildId",value:function(e,t){var n=this.get(e);n&&(n.childIds=function(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=K(b(e),function(e){return{value:e}});return Array.isArray(n)?n.reduce(function(e,t){return o[t]&&(i.stringifyFirst||o[t].value===t)||e.push(t),e},[]):ue(n)?Object.keys(n).reduce(function(e,t){return o[t]||(e[t]=n[t]),e},{}):n}(n.childIds,t))}}]),i}();var we=function(){function t(e){u(this,t),this._list=e,this.position=-1}return l(t,[{key:"getComponent",value:function(){return this._list.getAtPosition(this.position)}},{key:"next",value:function(){return this.position+1<this._list.length?(this.position++,this.getComponent()):null}}]),t}(),Pe=function(){function e(){u(this,e),this._list=[],this._idToIndex={},this.longestSequence=1,this._longestSequenceComponentId=null,this._keyMapEventRecord=pe.newRecord()}return l(e,[{key:"add",value:function(e,t,n,i){if(this.containsId(e))return this.update(e,t,n,i);var o=this._build(e,t,n,i);this._list.push(o);var r=this.length-1;return this._idToIndex[e]=r}},{key:"containsId",value:function(e){return!!this.getById(e)}},{key:"getById",value:function(e){return this.getAtPosition(this.getPositionById(e))}},{key:"getPositionById",value:function(e){return this._idToIndex[e]}},{key:"update",value:function(e,t,n,i){var o=this._isUpdatingComponentWithLongestSequence(e),r=this.longestSequence,s=this._build(e,t,n,i);o&&s.sequenceLength!==r&&(s.sequenceLength>r?this.longestSequence=s.sequenceLength:this._recalculateLongestSequence()),this._list[this.getPositionById(e)]=s}},{key:"remove",value:function(e){var t=this._isUpdatingComponentWithLongestSequence(e);this.removeAtPosition(this.getPositionById(e)),t&&this._recalculateLongestSequence()}},{key:"isRoot",value:function(e){return this.getPositionById(e)>=this.length-1}},{key:"anyActionsForEventType",value:function(e){return!!this._keyMapEventRecord[e]}},{key:"getAtPosition",value:function(e){return this._list[e]}},{key:"removeAtPosition",value:function(e){var t,n;this._list=(t=this._list,n=e,[].concat(_(t.slice(0,n)),_(t.slice(n+1))));for(var i=e;i<this.length;)this._idToIndex[this.getAtPosition(i).componentId]=i,i++}},{key:"toJSON",value:function(){return this._list}},{key:"_build",value:function(e,t,n,i){return{actions:this._buildActionDictionary(t,i,e),handlers:n,componentId:e,options:i}}},{key:"_isUpdatingComponentWithLongestSequence",value:function(e){return e===this._getLongestSequenceComponentId()}},{key:"_getLongestSequenceComponentId",value:function(){return this._longestSequenceComponentId}},{key:"_recalculateLongestSequence",value:function(){for(var e=this.iterator;e.next();){var t=e.getComponent(),n=t.longestSequence,i=t.componentId;n>this.longestSequence&&(this._longestSequenceComponentId=i,this.longestSequence=n)}}},{key:"_buildActionDictionary",value:function(t,s,a){var u=this;return Object.keys(t).reduce(function(o,r){var e=t[r];return(ue(e)&&D(e,"sequences")?b(e.sequences):b(e)).forEach(function(e){var t=function(e,t){{if(ue(e)){var n=e.sequence,i=e.action;return{keySequence:n,keyEventType:H(i)?M[t.defaultKeyEvent]:M[i]}}return{keySequence:e,keyEventType:M[t.defaultKeyEvent]}}}(e,s),n=t.keySequence,i=t.keyEventType;u._addActionOptions(o,a,r,n,i)}),o},{})}},{key:"_addActionOptions",value:function(e,t,n,i,o){var r=te.parse(i,{keyEventType:o}),s=r.sequence,a=r.combination;s.size>this.longestSequence&&(this.longestSequence=s.size,this._longestSequenceComponentId=t),this._keyMapEventRecord[o]=ve,e[n]||(e[n]=[]),e[n].push(h({prefix:s.prefix,actionName:n,sequenceLength:s.size},a))}},{key:"iterator",get:function(){return new we(this)}},{key:"length",get:function(){return this._list.length}}]),e}();function He(e,t){return e[e.length-(t+1)]}for(var Te={Enter:!0,Backspace:!0,ArrowRight:!0,ArrowLeft:!0,ArrowUp:!0,ArrowDown:!0,CapsLock:!0},Me=1;Me<13;Me++)Te["F".concat(Me)]=!0;function Oe(e){return 1===e.length||D(Te,e)}var Ae=function(){function e(){u(this,e),this._actionConfigs={},this._order=null}return l(e,[{key:"addMatch",value:function(e,t){if(this._includesMatcherForCombination(e.id)){var n=e.keyEventType,i=e.actionName,o=e.id;this._addHandlerToActionConfig(o,{keyEventType:n,actionName:i,handler:t})}else this._addNewActionConfig(e,t)}},{key:"findMatch",value:function(e,t,n){var i=this;me(this,"order",function(){return i._setOrder()});var o=!0,r=!1,s=void 0;try{for(var a,u=this._order[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var c=a.value,l=this._actionConfigs[c];if(this._matchesActionConfig(e,t,n,l))return l}}catch(e){r=!0,s=e}finally{try{o||null==u.return||u.return()}finally{if(r)throw s}}return null}},{key:"toJSON",value:function(){return{actionConfigs:this._actionConfigs,order:this._order}}},{key:"_matchesActionConfig",value:function(t,n,i,e){if(r=t,s=ce(e.keyDictionary),a=new Ke(r),!(w.option("allowCombinationSubmatches")||(o=r).isKeyStillPressed("Meta")&&new Ke(o).some(function(e){return Oe(e)})?a.numberOfKeys>=s:a.numberOfKeys===s)||!e.events[i])return!1;var o,r,s,a,u=!1;return Object.keys(e.keyDictionary).every(function(e){return!!t.isEventTriggered(e,i)&&(n&&n===t.getNormalizedKeyName(e)&&(u=!t.wasEventPreviouslyTriggered(e,i)),!0)})&&u}},{key:"_setOrder",value:function(){var n=C(this._actionConfigs).reduce(function(e,t){var n=t.id,i=t.size;return e[i]||(e[i]=[]),e[i].push(n),e},{});this._order=Object.keys(n).sort(function(e,t){return t-e}).reduce(function(e,t){return e.concat(n[t])},[])}},{key:"_addNewActionConfig",value:function(e,t){var n=e.prefix,i=e.sequenceLength,o=e.id,r=e.keyDictionary,s=e.size,a=e.keyEventType,u=e.actionName;this._setCombinationMatcher(o,{prefix:n,sequenceLength:i,id:o,keyDictionary:r,size:s,events:{}}),this._addHandlerToActionConfig(o,{keyEventType:a,actionName:u,handler:t})}},{key:"_addHandlerToActionConfig",value:function(e,t){var n=t.keyEventType,i=t.actionName,o=t.handler,r=this._getCombinationMatcher(e);this._setCombinationMatcher(e,h({},r,{events:h({},r.events,s({},n,{actionName:i,handler:o}))}))}},{key:"_setCombinationMatcher",value:function(e,t){this._actionConfigs[e]=t}},{key:"_getCombinationMatcher",value:function(e){return this._actionConfigs[e]}},{key:"_includesMatcherForCombination",value:function(e){return!!this._getCombinationMatcher(e)}}]),e}();function Le(e,t){for(var n=0,i=!0;i&&n<e.length;){var o=(He(e,n)+1)%(He(t,n)||1);(i=0===(e[e.length-(n+1)]=o))&&n++}return n===e.length}var xe=function(){function e(){u(this,e),this._combinationMatchers={},this._eventRecord=pe.newRecord()}return l(e,[{key:"addMatch",value:function(e,t){this._getOrCreateCombinationMatcher(e.prefix).addMatch(e,t),pe.setBit(this._eventRecord,e.keyEventType,ve),(!this.longestSequence||this.longestSequence<e.sequenceLength)&&(this.longestSequence=e.sequenceLength)}},{key:"findMatch",value:function(e,t,n){var i=this._findCombinationMatcher(e);return i?i.findMatch(e.currentCombination,e.currentCombination.getNormalizedKeyName(t),n):null}},{key:"hasMatchesForEventType",value:function(e){return!!this._eventRecord[e]}},{key:"toJSON",value:function(){var i=this;return Object.keys(this._combinationMatchers).reduce(function(e,t){var n=i._combinationMatchers[t];return e[t]=n.toJSON(),e},{})}},{key:"_getOrCreateCombinationMatcher",value:function(e){return me(this._combinationMatchers,e,function(){return new Ae})}},{key:"_findCombinationMatcher",value:function(e){var t=e.getPreviousCombinations(this.longestSequence-1);if(0===t.length)return this._combinationMatchers[""];var n=t.map(function(e){return e.ids}),i=n.map(function(e){return e.length}),o=new Array(n.length).fill(0);do{var r=o.map(function(e,t){return n[t][e]}).join(" ");if(this._combinationMatchers[r])return this._combinationMatchers[r]}while(!Le(o,i));return this._combinationMatchers[""]}}]),e}();function Fe(e){return JSON.stringify(e,De,4)}function De(e,t){return"function"==typeof t?t.toString():t}function Re(e){switch(parseInt(e,10)){case 0:return"keydown";case 1:return"keypress";default:return"keyup"}}var Ne=function(){function r(e,t,n){u(this,r),this.logger=n,this._eventStrategy=t,this._keyMapMatchers=[],this._unmatchedHandlerStatus=[],this._handlersDictionary={},this._keySequencesDictionary={};for(var i=e.iterator;i.next();){var o=i.getComponent().handlers;this._unmatchedHandlerStatus.push([Object.keys(o).length,{}]),this._keyMapMatchers.push(new xe)}this._componentList=e,this._componentListIterator=e.iterator}return l(r,[{key:"getKeyHistoryMatcher",value:function(e){if(this._componentHasUnmatchedHandlers(e))for(;this._componentListIterator.next();)this._addHandlersFromComponent(),this._addActionsFromComponent();return this._getKeyHistoryMatcher(e)}},{key:"componentHasActionsBoundToEventType",value:function(e,t){return this.getKeyHistoryMatcher(e).hasMatchesForEventType(t)}},{key:"findMatchingKeySequenceInComponent",value:function(e,t,n,i){return this.componentHasActionsBoundToEventType(e,i)?this.getKeyHistoryMatcher(e).findMatch(t,n,i):null}},{key:"callClosestMatchingHandler",value:function(e,t,n,i,o){for(;o<=i;){this.getKeyHistoryMatcher(o);var r=this._eventStrategy.componentList.getAtPosition(o).componentId,s=this._eventStrategy.keyHistory,a=s.currentCombination,u=this.findMatchingKeySequenceInComponent(o,s,t,n);if(u)return this._handleMatchFound(a,u,n,r,e,o),!0;this._handleMatchNotFound(a,o,n,r),o++}}},{key:"_handleMatchNotFound",value:function(e,t,n,i){new Ee(e);this.componentHasActionsBoundToEventType(t,n)}},{key:"_handleMatchFound",value:function(e,t,n,i,o,r){new Ee(e);var s=t.events[n];if(w.option("allowCombinationSubmatches"))he.serialize(t.keyDictionary);s.handler(o),w.option("stopEventPropagationAfterHandling")&&this._eventStrategy.stopEventPropagation(o,r)}},{key:"_getKeyHistoryMatcher",value:function(e){return this._keyMapMatchers[e]}},{key:"_addActionsFromComponent",value:function(){var t=this,n=this._componentListIterator.getComponent().actions;Object.keys(n).forEach(function(e){t._buildActionMatchers(e,n[e])})}},{key:"_buildActionMatchers",value:function(i,e){var o=this,t=this._positionsOfComponentsWithHandlersFor(i);return!!t&&(this._registerActionWithMatcher(t,i,e),t.forEach(function(e){var t=o._getUnmatchedHandlerStatus(e),n=t[1];n[i]||(n[i]=!0,t[0]--)}),!0)}},{key:"_positionsOfComponentsWithHandlersFor",value:function(e){return this._handlersDictionary[e]}},{key:"_registerActionWithMatcher",value:function(e,t,n){var r=this,s=e[0],a=this._componentList.getAtPosition(s).handlers[t],u=this._getKeyHistoryMatcher(s);return n.forEach(function(e){var t=e.prefix,n=e.id,i=e.keyEventType,o=[t,n].join(" ");if(r._isClosestHandlerAlreadyFoundFor(o,i))return!1;u.addMatch(e,a),r._recordHandlerFoundFor(o,[s,i])}),!0}},{key:"_addHandlersFromComponent",value:function(){var t=this,e=this._componentListIterator.getComponent().handlers;Object.keys(e).forEach(function(e){t._addHandler(e)})}},{key:"_addHandler",value:function(e){me(this._handlersDictionary,e,[]),this._handlersDictionary[e].push(this._componentListIterator.position)}},{key:"_recordHandlerFoundFor",value:function(e,t){me(this._keySequencesDictionary,e,[]),this._keySequencesDictionary[e].push(t)}},{key:"_componentHasUnmatchedHandlers",value:function(e){return 0<this._getUnmatchedHandlerStatus(e)[0]}},{key:"_getUnmatchedHandlerStatus",value:function(e){return this._unmatchedHandlerStatus[e]}},{key:"_isClosestHandlerAlreadyFoundFor",value:function(e,t){return(this._keySequencesDictionary[e]||[]).some(function(e){return e[1]===t})}}]),r}(),je=function(){function t(){var e=1<arguments.length?arguments[1]:void 0;u(this,t),this.logger=null,this.componentId=-1,this.keyEventManager=e,this.componentTree=new Ie,this._simulator=null,this._reset(),this.resetKeyHistory()}return l(t,[{key:"_reset",value:function(){this.componentList=new Pe,this._actionResolver=null}},{key:"_recalculate",value:function(){this._actionResolver=null,this.keyHistory.maxLength=this.componentList.longestSequence}},{key:"resetKeyHistory",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._simulator&&this._simulator.clear(),this.keyHistory.any()&&!e.force?this._keyHistory=new Ce({maxLength:this.componentList.longestSequence},new be(this)):this._keyHistory=this._newKeyHistory()}},{key:"_newKeyHistory",value:function(){return new Ce({maxLength:this.componentList.longestSequence})}},{key:"registerKeyMap",value:function(e){return this.componentId+=1,this.componentTree.add(this.componentId,e),this.componentId}},{key:"reregisterKeyMap",value:function(e,t){this.componentTree.update(e,t)}},{key:"registerComponentMount",value:function(e,t){this.componentTree.setParent(e,t)}},{key:"deregisterKeyMap",value:function(e){this.componentTree.remove(e),this.componentTree.isRootId(e)&&this.componentTree.clearRootId()}},{key:"_addComponent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=4<arguments.length?arguments[4]:void 0;this.componentList.add(e,t,n,i),this._recalculate(),this.logger.logComponentOptions(e,this.componentList.getById(e))}},{key:"_updateComponent",value:function(e,t,n,i){this.componentList.update(e,t,n,i),this._recalculate(),this.logger.logComponentOptions(e,this.componentList.getById(e))}},{key:"_describeCurrentCombination",value:function(){return new Ee(this.currentCombination).describe()}},{key:"_recordKeyDown",value:function(e,t,n){var i=_e(e),o=this.currentCombination;o.isKeyIncluded(t)||o.isEnding?this._startAndLogNewKeyCombination(n,t,i):this._recordNewKeyInCombination(t,M.keydown,i,n)}},{key:"_startAndLogNewKeyCombination",value:function(e,t,n){this.keyHistory.startNewKeyCombination(t,n),this.logger.logKeyHistory(this.keyHistory,e)}},{key:"_recordNewKeyInCombination",value:function(e,t,n,i){this.keyHistory.addKeyToCurrentCombination(e,t,n),this.logger.logKeyHistory(this.keyHistory,i)}},{key:"_isIgnoringRepeatedEvent",value:function(e,t,n,i){return!(!e.repeat||!w.option("ignoreRepeatedEventsWhenKeyHeldDown"))&&(this.logger.logIgnoredKeyEvent(e,t,n,"it was a repeated event",i),!0)}},{key:"keyHistory",get:function(){var e=this;return me(this,"_keyHistory",function(){return e._newKeyHistory()})}},{key:"actionResolver",get:function(){var e=this;return me(this,"_actionResolver",function(){return new Ne(e.componentList,e,e.logger)})}},{key:"currentCombination",get:function(){return this.keyHistory.currentCombination}}]),t}();var qe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"};function Be(e){var t=w.option("customKeyCodes"),n=e.keyCode||e.charCode;return D(t,n)?t[n]:e.nativeEvent?e.key:function(e){if(e.key){var t=qe[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"!==e.type)return"keydown"===e.type||"keyup"===e.type?$[e.keyCode]||"Unidentified":"";var n,i,o,r=(o=(n=e).keyCode,"charCode"in n?0===(i=n.charCode)&&13===o&&(i=13):i=o,10===i&&(i=13),32<=i||13===i?i:0);return 13===r?"Enter":String.fromCharCode(r)}(e)}function Ue(e){var t=Be(e);return"+"===t?"plus":t}function ze(e){return"Meta"===e}function We(e,t,n){var i="'".concat(t,"' ").concat(Re(n));return e.simulated?"(simulated) ".concat(i):i}var Ge=0,Je=1,Ve=2,$e=4,Ye=function(){function e(){u(this,e)}return l(e,null,[{key:"incrementId",value:function(){this._id=this.id+1}},{key:"id",get:function(){return me(this,"_id",0),this._id}}]),e}(),Qe=function(){function i(e){u(this,i),this._componentList=e,this._previousPropagation=null,this._reset()}return l(i,[{key:"_reset",value:function(){this.previousPosition=-1,this._position=-1,this._actionHandled=!1,this._ignoreEvent=!1,this._observeIgnoredEvents=!1,this._stopping=!1,this._componentId=null,this._key=null,this._type=null}},{key:"isFirstPropagationStep",value:function(){var e=this.previousPosition;return-1===e||e>=this._position}},{key:"isForKey",value:function(e){return this._key===e}},{key:"isForEventType",value:function(e){return this._type===e}},{key:"startNewPropagationStep",value:function(e,t,n,i){return this._position=this._componentList.getPositionById(e),this._componentId=e,this.isFirstPropagationStep()&&(Ye.incrementId(),this._key=t.key,this._type=i),!t.repeat||!w.option("ignoreRepeatedEventsWhenKeyHeldDown")||(this.ignoreEvent(t),!1)}},{key:"finishPropagationStep",value:function(){this.isStopped()||this._componentList.isRoot(this._componentId)?(this._previousPropagation=this._clone(),this._reset()):this.previousPosition=this._position}},{key:"observeIgnoredEvents",value:function(){this._observeIgnoredEvents=!0}},{key:"ignoreEvent",value:function(e){return this._ignoreEvent=!0,!(!this.isIgnoringEvent()||!w.option("stopEventPropagationAfterIgnoring"))&&(this.stop(e),this.finishPropagationStep(),!0)}},{key:"isIgnoringEvent",value:function(){return!this._observeIgnoredEvents&&this._ignoreEvent}},{key:"isStopped",value:function(){return this._stopping}},{key:"stop",value:function(e){return!this.isStopped()&&(this._stopping=!0,e.simulated||e.stopPropagation(),!0)}},{key:"isPendingPropagation",value:function(){var e=this.previousPosition;return-1!==e&&e+1<this._position}},{key:"isHandled",value:function(){return this._actionHandled}},{key:"setHandled",value:function(){this._actionHandled=!0}},{key:"_clone",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).copyState,t=void 0===e||e,n=new i(this._componentList);return n.logger=this.logger,t&&Object.assign(n,this),n}},{key:"previousPropagation",get:function(){var e=this;return me(this,"_previousPropagation",function(){return e._clone({copyState:!1})})}}]),i}();var Xe=function(){function t(e){u(this,t),this._keyEventStrategy=e,this.clear()}return l(t,[{key:"clear",value:function(){this.keypressEventsToSimulate=[],this.keyupEventsToSimulate=[]}},{key:"cloneAndMergeEvent",value:function(n,e){return h({},Object.keys(ke).reduce(function(e,t){return e[t]=n[t],e},{}),e)}},{key:"_shouldSimulate",value:function(e,t){var n=!Q(t),i=this._keyEventStrategy.currentCombination;return e===M.keypress?!n||n&&i.isKeyStillPressed("Meta"):e===M.keyup&&(Oe(t)&&i.isKeyReleased("Meta"))}}]),t}(),Ze=function(e){function t(){return u(this,t),m(this,d(t).apply(this,arguments))}return y(t,Xe),l(t,[{key:"handleKeyPressSimulation",value:function(e){this._handleEventSimulation("keypressEventsToSimulate","simulatePendingKeyPressEvents",h({eventType:M.keypress},e))}},{key:"handleKeyUpSimulation",value:function(e){this._handleEventSimulation("keyupEventsToSimulate","simulatePendingKeyUpEvents",h({eventType:M.keyup},e))}},{key:"_handleEventSimulation",value:function(e,t,n){var i=n.event,o=n.eventType,r=n.key,s=n.focusTreeId,a=n.componentId,u=n.options;if(this._shouldSimulate(o,r)&&w.option("simulateMissingKeyPressEvents")){var c=this.cloneAndMergeEvent(i,{key:r,simulated:!0});this[e].push({event:c,focusTreeId:s,componentId:a,options:u})}(this._keyEventStrategy.componentList.isRoot(a)||this._keyEventStrategy.eventPropagator.isStopped())&&this._shouldSimulateEventsImmediately()&&this._keyEventStrategy[t]()}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulatePendingKeyEvents("keypressEventsToSimulate","handleKeyPress")}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulatePendingKeyEvents("keyupEventsToSimulate","handleKeyUp")}},{key:"_simulatePendingKeyEvents",value:function(e,r){var s=this;0<this[e].length&&Ye.incrementId(),this[e].forEach(function(e){var t=e.event,n=e.focusTreeId,i=e.componentId,o=e.options;s._keyEventStrategy[r](t,n,i,o)}),this[e]=[]}},{key:"_shouldSimulateEventsImmediately",value:function(){return this._keyEventStrategy.shouldSimulateEventsImmediately()}}]),t}(),et=function(){function e(){u(this,e),this.id=0}return l(e,[{key:"isNewerThan",value:function(e){return this.id!==e}},{key:"new",value:function(){this.id+=1}}]),e}(),tt=function(e){function i(e,t){var n;return u(this,i),(n=m(this,d(i).call(this,e)))._eventStrategy=t,n}return y(i,T),l(i,[{key:"nonKeyEventPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.keyEventPrefix(e,h({},t,{eventId:!1}))}},{key:"logComponentOptions",value:function(e,t){this.verbose(this.nonKeyEventPrefix(e),"New component options:\n",Fe(t))}},{key:"logKeyHistory",value:function(e,t){this.verbose(this.keyEventPrefix(t),"Key history: ".concat(Fe(e.toJSON()),"."))}}]),i}(),nt=function(e){function c(){return u(this,c),m(this,d(c).apply(this,arguments))}return y(c,tt),l(c,[{key:"keyEventPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=k(d(c.prototype),"constructor",this).logIcons,i=k(d(c.prototype),"constructor",this).eventIcons,o=k(d(c.prototype),"constructor",this).componentIcons,r="HotKeys (";if(!1!==t.focusTreeId){var s=H(t.focusTreeId)?this._eventStrategy.focusTreeId:t.focusTreeId;r+="F".concat(s).concat(n[s%n.length],"-")}r+="C".concat(e).concat(o[e%o.length]);var a=this._eventStrategy.componentList.getPositionById(e);if(H(a)||(r+="-P".concat(a).concat(o[a%o.length])),!1!==t.eventId){var u=H(t.eventId)?Ye.id:t.eventId;r+="-E".concat(u).concat(i[u%i.length])}return"".concat(r,"):")}},{key:"logIgnoredKeyEvent",value:function(e,t,n,i,o){this.logIgnoredEvent(We(e,t,n),i,o)}},{key:"logIgnoredEvent",value:function(e,t,n){this.debug(this.keyEventPrefix(n),"Ignored ".concat(e," because ").concat(t,"."))}},{key:"logAlreadySimulatedEvent",value:function(e,t,n,i){this.logIgnoredKeyEvent(e,t,n,"it was not expected, and has already been simulated",i)}}]),c}(),it=function(e){function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;return u(this,i),(e=m(this,d(i).call(this,t,n))).logger=new nt(t.logLevel||"warn",g(g(e))),e.eventPropagator.logger=e.logger,e.focusTree=new et,e._simulator=new Ze(g(g(e))),e}return y(i,je),l(i,[{key:"_reset",value:function(){k(d(i.prototype),"_reset",this).call(this),this._simulator&&this._simulator.clear(),this.focusTree&&this.focusTree.new(),this.eventPropagator=new Qe(this.componentList),this.eventPropagator.logger=this.logger}},{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;if(this.resetOnNextFocus&&(this._reset(),this.resetOnNextFocus=!1),!this.componentList.containsId(e))return this._addComponent(e,t,n,"Focused",i),this.focusTree.id}},{key:"updateEnabledHotKeys",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=4<arguments.length?arguments[4]:void 0;!this.focusTree.isNewerThan(e)&&this.componentList.containsId(t)&&this._updateComponent(t,n,i,o)}},{key:"disableHotKeys",value:function(e,t){return this.resetOnNextFocus=!0,this.eventPropagator.isPendingPropagation()}},{key:"handleKeyDown",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},o=Ue(e);if(this.focusTree.isNewerThan(t))return this.logger.logIgnoredKeyEvent(e,o,M.keydown,"it had an old focus tree id: ".concat(t),n),this.eventPropagator.ignoreEvent(e),!0;if(this._isIgnoringRepeatedEvent(e,o,M.keydown,n))return!1;this.eventPropagator.startNewPropagationStep(n,e,o,M.keydown)&&(this._howToHandleKeyEvent(e,t,n,o,i,M.keydown)===$e&&(this._recordKeyDown(e,o,n),this._callHandlerIfActionNotHandled(e,o,M.keydown,n,t)),this._simulator.handleKeyPressSimulation({event:e,key:o,focusTreeId:t,componentId:n,options:i}),this.eventPropagator.finishPropagationStep());return!1}},{key:"_howToHandleKeyEvent",value:function(e,t,n,i,o,r){if(this.eventPropagator.isFirstPropagationStep()){if(o.ignoreEventsCondition(e)&&this.eventPropagator.ignoreEvent(e))return this._eventIsToBeIgnored(e,n,i,r);this.currentCombination.resolveModifierFlagDiscrepancies(e,i,r)}else if(this.eventPropagator.isIgnoringEvent())return this._eventIsToBeIgnored(e,n,i,r);return $e}},{key:"_eventIsToBeIgnored",value:function(e,t,n,i){return this.logger.logIgnoredKeyEvent(e,n,i,"ignoreEventsFilter rejected it",t),Je}},{key:"handleKeyPress",value:function(e,t,n,i){var o=Ue(e);if(this._isIgnoringRepeatedEvent(e,o,M.keypress,n))return!1;if(this.currentCombination.isKeyPressSimulated(o))return this._ignoreAlreadySimulatedEvent(e,o,M.keypress,n),!1;var r=this.focusTree.isNewerThan(t);if(this.eventPropagator.startNewPropagationStep(n,e,o,M.keypress)){var s=this._howToHandleKeyEvent(e,t,n,o,i,M.keypress);this.eventPropagator.isFirstPropagationStep(n)&&this.currentCombination.isKeyIncluded(o)&&this._recordNewKeyInCombination(o,M.keypress,_e(e),n),s===$e&&this._callHandlerIfActionNotHandled(e,o,M.keypress,n,t),this.eventPropagator.finishPropagationStep()}return r}},{key:"handleKeyUp",value:function(e,t,n,i){var o=Ue(e);if(this.currentCombination.isKeyUpSimulated(o))return this._ignoreAlreadySimulatedEvent(e,o,M.keyup,n),!1;var r=this.focusTree.isNewerThan(t),s=this.eventPropagator;if(s.startNewPropagationStep(n,e,o,M.keyup)){var a=this._howToHandleKeyEvent(e,t,n,o,i,M.keyup);s.isFirstPropagationStep(n)&&this.currentCombination.isKeyIncluded(o)&&this._recordNewKeyInCombination(o,M.keyup,_e(e),n),a===$e&&this._callHandlerIfActionNotHandled(e,o,M.keyup,n,t),this._simulateKeyUpEventsHiddenByCmd(e,o,t,n,i),s.finishPropagationStep()}return r}},{key:"_ignoreAlreadySimulatedEvent",value:function(e,t,n,i){this.logger.logAlreadySimulatedEvent(e,t,n,i),this.eventPropagator.ignoreEvent(e)}},{key:"closeHangingKeyCombination",value:function(e,t){var n=this.currentCombination;n.isKeyIncluded(e)&&!n.isEventTriggered(e,t)&&n.setKeyState(e,t,fe)}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e,n,i,o){var r=this;ze(e)&&new Ke(this.currentCombination).forEachKey(function(e){ze(e)||r._simulator.handleKeyUpSimulation({event:t,key:e,focusTreeId:n,componentId:i,options:o})})}},{key:"stopEventPropagation",value:function(e,t){this.eventPropagator.stop(e)}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulator.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulator.simulatePendingKeyUpEvents()}},{key:"shouldSimulateEventsImmediately",value:function(){return!this.keyEventManager.isGlobalListenersBound()}},{key:"_callHandlerIfActionNotHandled",value:function(e,t,n,i,o){var r=Re(n),s=this._describeCurrentCombination();if(this.componentList.anyActionsForEventType(n))if(this.eventPropagator.isHandled())this.logger.logIgnoredEvent("'".concat(s,"' ").concat(r),"it has already been handled",i);else{var a=this.eventPropagator.previousPosition,u=this.componentList.getPositionById(i);this.actionResolver.callClosestMatchingHandler(e,t,n,u,-1===a?0:a)&&this.eventPropagator.setHandled()}else this.logger.logIgnoredEvent("'".concat(s,"' ").concat(r),"it doesn't have any ".concat(r," handlers"),i)}}]),i}();function ot(e,t){var n,i,o,r,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(e)||B(e)?(n=e,i=t,s.stringifyFirst?!H(n.find(function(e){return e.toString()===i.toString()})):-1!==n.indexOf(i)):ue(e)?D(e,t):(o=e,r=t,s.stringifyFirst?o.toString()===r.toString():o===r)}var rt=function(e){function t(){return u(this,t),m(this,d(t).apply(this,arguments))}return y(t,Xe),l(t,[{key:"handleKeyPressSimulation",value:function(e){this._handleEventSimulation("handleKeyPress",h({eventType:M.keypress},e))}},{key:"handleKeyUpSimulation",value:function(e){this._handleEventSimulation("handleKeyUp",h({eventType:M.keyup},e))}},{key:"_handleEventSimulation",value:function(e,t){var n=t.event,i=t.eventType,o=t.key;if(this._shouldSimulate(i,o)&&w.option("simulateMissingKeyPressEvents")){var r=this.cloneAndMergeEvent(n,{key:o,simulated:!0});this._keyEventStrategy[e](r)}}}]),t}();function st(e){return e.replace(/\b\w/g,function(e){return e.toUpperCase()})}var at=function(){function i(e,t){var n=t.logger;u(this,i),this._listenersBound=!1,this.logger=n,this._eventStrategy=e}return l(i,[{key:"isListenersBound",value:function(){return this._listenersBound}},{key:"unbindListeners",value:function(){var n=this;C(M).forEach(function(e){var t=Re(e);delete document["on".concat(t)],n._logHandlerStateChange("Removed",t)}),this._listenersBound=!1}},{key:"bindListeners",value:function(){var i=this;C(M).forEach(function(e){var n=Re(e);document["on".concat(n)]=function(e){var t;i._eventStrategy["handle".concat((t=n,"".concat(st(t.slice(0,3))).concat(st(t.slice(3)))))](e)},i._logHandlerStateChange("Bound",n)}),this._listenersBound=!0}},{key:"_logHandlerStateChange",value:function(e,t){}}]),i}(),ut=function(e){function s(){return u(this,s),m(this,d(s).apply(this,arguments))}return y(s,tt),l(s,[{key:"keyEventPrefix",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=k(d(s.prototype),"constructor",this).eventIcons,i=k(d(s.prototype),"constructor",this).componentIcons,o="HotKeys (GLOBAL";if(!H(e))return"".concat(o,"-C").concat(e).concat(i[e%i.length],"):");if(!1===t.eventId)return"".concat(o,"):");var r=H(t.eventId)?Ye.id:t.eventId;return"".concat(o,"-E").concat(r).concat(n[r%n.length],"):")}},{key:"logIgnoredKeyEvent",value:function(e,t,n,i,o){this.logIgnoredEvent(We(e,t,n),i,o)}},{key:"logIgnoredEvent",value:function(e,t,n){this.debug(this.keyEventPrefix(n),"Ignored ".concat(e," because ").concat(t,"."))}},{key:"logEventRejectedByFilter",value:function(e,t,n,i){this.logIgnoredKeyEvent(e,t,n,"ignoreEventsFilter rejected it",i)}},{key:"logEventAlreadySimulated",value:function(e,t,n,i){this.logIgnoredKeyEvent(e,t,n,"it was not expected, and has already been simulated",i)}}]),s}(),ct=function(e){function i(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;return u(this,i),(e=m(this,d(i).call(this,t,n))).logger=new ut(t.logLevel||"warn",g(g(e))),e.eventOptions={ignoreEventsCondition:w.option("ignoreEventsCondition")},e.listeners=new Se,e._simulator=new rt(g(g(e))),e._listenerAdaptor=new at(g(g(e)),{logger:e.logger}),e}return y(i,je),l(i,[{key:"enableHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;this.eventOptions=o,this._addComponent(e,t,n,"Mounted",i)}},{key:"updateEnabledHotKeys",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;this.eventOptions=o,this._updateComponent(e,t,n,i)}},{key:"disableHotKeys",value:function(e){this.componentList.remove(e),this._recalculate()}},{key:"_recalculate",value:function(){k(d(i.prototype),"_recalculate",this).call(this),this._updateDocumentHandlers()}},{key:"_updateDocumentHandlers",value:function(){var e=this._shouldListenersBeBound(),t=this.isListenersBound();!t&&e?this._listenerAdaptor.bindListeners():t&&!e&&this._listenerAdaptor.unbindListeners()}},{key:"isListenersBound",value:function(){return this._listenerAdaptor.isListenersBound()}},{key:"_shouldListenersBeBound",value:function(){return 0!==this.componentList.length||this.listeners.get("keyCombination")}},{key:"handleKeyDown",value:function(e){var t=Ue(e);if(!this._isIgnoringRepeatedEvent(e,t,M.keydown)){this.currentCombination.resolveModifierFlagDiscrepancies(e,t,M.keydown);var n=this._howReactAppRespondedTo(e,t,M.keydown);n===Ge&&this.eventOptions.ignoreEventsCondition(e)?this.logger.logEventRejectedByFilter(e,t,M.keydown):(n!==Je&&this._recordKeyDown(e,t),this._callHandlerIfNeeded(n,e,t,M.keydown),this.keyEventManager.simulatePendingKeyPressEvents(),this._simulator.handleKeyPressSimulation({event:e,key:t}))}}},{key:"_howReactAppRespondedTo",value:function(e,t,n){var i=this.keyEventManager.reactAppHistoryWithEvent(t,n);switch(i){case $e:this.logger.logIgnoredKeyEvent(e,t,n,"React app has already handled it");break;case Je:this.logger.logIgnoredKeyEvent(e,t,n,"React app has declared it should be ignored");break;case Ve:break;default:Ye.incrementId()}return i}},{key:"handleKeyPress",value:function(e){var t=Ue(e);if(!this._isIgnoringRepeatedEvent(e,t,M.keypress))if(this.currentCombination.isKeyPressSimulated(t))this.logger.logEventAlreadySimulated(e,t,M.keypress);else{var n=this._howReactAppRespondedTo(e,t,M.keypress);this.currentCombination.isKeyIncluded(t)&&this._recordNewKeyInCombination(t,M.keypress,_e(e)),n===Ge&&(this.keyEventManager.closeHangingKeyCombination(t,M.keypress),this.eventOptions.ignoreEventsCondition(e))?this.logger.logEventRejectedByFilter(e,t,M.keypress):this._callHandlerIfNeeded(n,e,t,M.keypress)}}},{key:"_callHandlerIfNeeded",value:function(e,t,n,i){ot([Je,$e],e)||this._callHandlerIfExists(t,n,i)}},{key:"handleKeyUp",value:function(e){var t=Ue(e);if(this.currentCombination.isKeyUpSimulated(t))this.logger.logEventAlreadySimulated(e,t,M.keyup);else{var n=this._howReactAppRespondedTo(e,t,M.keyup);this.currentCombination.isKeyIncluded(t)&&this._recordNewKeyInCombination(t,M.keyup,_e(e)),n===Ge?(this.keyEventManager.closeHangingKeyCombination(t,M.keyup),this.eventOptions.ignoreEventsCondition(e)?this.logger.logIgnoredKeyEvent(e,t,M.keyup,"ignoreEventsFilter rejected it"):this._callHandlerIfNeeded(n,e,t,M.keyup)):this._callHandlerIfNeeded(n,e,t,M.keyup),this._simulateKeyUpEventsHiddenByCmd(e,t),this._callKeyCombinationCallbackIfDefined()}}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e){var n=this;ze(e)&&(this.keyEventManager.simulatePendingKeyUpEvents(),new Ke(this.currentCombination).forEachKey(function(e){ze(e)||n._simulator.handleKeyUpSimulation({event:t,key:e})}))}},{key:"_callKeyCombinationCallbackIfDefined",value:function(){if(this.listeners.get("keyCombination")&&this.currentCombination.hasEnded()){var e=new Ee(this.currentCombination);this.listeners.get("keyCombination")({keys:e.asKeyDictionary(),id:e.describe()})}}},{key:"_callHandlerIfExists",value:function(e,t,n){var i=Re(n),o=this._describeCurrentCombination();this.componentList.anyActionsForEventType(n)?this._callClosestMatchingHandler(e,t,n):this.logger.logIgnoredEvent("'".concat(o,"' ").concat(i),"it doesn't have any ".concat(i," handlers"))}},{key:"_callClosestMatchingHandler",value:function(e,t,n){for(var i=this.componentList.iterator;i.next();){if(this.actionResolver.callClosestMatchingHandler(e,t,n,i.position,0))return}}},{key:"stopEventPropagation",value:function(e,t){e.simulated||e.stopPropagation()}},{key:"addKeyCombinationListener",value:function(t){var e=this,n=function(){e.listeners.remove("keyCombination")};return this.listeners.set("keyCombination",function(e){t(e),n()}),this._updateDocumentHandlers(),n}}]),i}();function lt(t,n,e){return e.forEach(function(e){D(t,e)&&(n[e]=t[e])}),n}var ht=["sequence","action"],yt=["name","description","group"];function dt(e){return b(e).map(function(e){return ue(e)?lt(e,{},ht):{sequence:e}})}var vt=function(){function t(e){u(this,t),this._componentTree=e}return l(t,[{key:"build",value:function(){return this._componentTree.hasRoot()?this._build([this._componentTree.rootId],{}):{}}},{key:"_build",value:function(e,r){var i=this;return e.forEach(function(e){var t=i._componentTree.get(e),n=t.childIds,o=t.keyMap;o&&Object.keys(o).forEach(function(e){var t,n,i;n=r,i=o[t=e],n[t]={},ue(i)?D(i,"sequences")?(lt(i,n[t],yt),n[t].sequences=dt(i.sequences)):(lt(i,n[t],yt),n[t].sequences=[lt(i,{},ht)]):n[t].sequences=dt(i)}),i._build(n,r)}),r}}]),t}(),ft=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,n);var t=w.option("logLevel");this.logger=e.logger||new T(t),this.focusOnlyEventStrategy=new it({configuration:e,logLevel:t},this),this.globalEventStrategy=new ct({configuration:e,logLevel:t},this),this.mountedComponentsCount=0,this._blurHandler=this._clearKeyHistory.bind(this)}return l(n,null,[{key:"getInstance",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return me(this,"instance",function(){return new n(e)})}},{key:"getFocusOnlyEventStrategy",value:function(){return this.getInstance().focusOnlyEventStrategy}},{key:"getGlobalEventStrategy",value:function(){return this.getInstance().globalEventStrategy}}]),l(n,[{key:"registerComponentMount",value:function(e,t){return this._incrementComponentCount(),this.focusOnlyEventStrategy.registerComponentMount(e,t)}},{key:"registerComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"_incrementComponentCount",value:function(){var e=this.mountedComponentsCount;this.mountedComponentsCount+=1,0===e&&1===this.mountedComponentsCount&&window.addEventListener("blur",this._blurHandler)}},{key:"_decrementComponentCount",value:function(){var e=this.mountedComponentsCount;this.mountedComponentsCount-=1,1===e&&0===this.mountedComponentsCount&&window.removeEventListener("blur",this._blurHandler)}},{key:"_clearKeyHistory",value:function(){this.focusOnlyEventStrategy.resetKeyHistory({force:!0}),this.globalEventStrategy.resetKeyHistory({force:!0})}},{key:"registerGlobalComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"registerGlobalComponentMount",value:function(e,t){return this._incrementComponentCount(),this.globalEventStrategy.registerComponentMount(e,t)}},{key:"addKeyCombinationListener",value:function(e){return this.globalEventStrategy.addKeyCombinationListener(e)}},{key:"ignoreEvent",value:function(e){this.focusOnlyEventStrategy.eventPropagator.ignoreEvent(e)}},{key:"observeIgnoredEvents",value:function(e){this.focusOnlyEventStrategy.eventPropagator.observeIgnoredEvents(e)}},{key:"closeHangingKeyCombination",value:function(e,t){this.focusOnlyEventStrategy.closeHangingKeyCombination(e,t)}},{key:"reactAppHistoryWithEvent",value:function(e,t){var n=this.focusOnlyEventStrategy.eventPropagator.previousPropagation;return n.isForKey(e)&&n.isForEventType(t)?n.isHandled()?$e:n.isIgnoringEvent()?Je:Ve:Ge}},{key:"simulatePendingKeyPressEvents",value:function(){this.focusOnlyEventStrategy.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this.focusOnlyEventStrategy.simulatePendingKeyUpEvents()}},{key:"isGlobalListenersBound",value:function(){return this.globalEventStrategy.isListenersBound()}},{key:"applicationKeyMap",get:function(){return[this.globalEventStrategy,this.focusOnlyEventStrategy].reduce(function(e,t){return h({},e,new vt(t.componentTree).build())},{})}}]),n}();function pt(t,n){return"function"==typeof t?function(e){t(e),n(e)}:n}function gt(){return{defaultKeyEvent:w.option("defaultKeyEvent")}}var mt=function(){function i(e,t){var n=t.keyMap;u(this,i),this._hotKeysOptions=e,this.id=ft.getFocusOnlyEventStrategy().registerKeyMap(n),this.childContext={hotKeysParentId:this.id},this._focusTreeIds=[]}return l(i,[{key:"getComponentProps",value:function(e){var t=this,n={onFocus:pt(e.onFocus,function(){return t.enableHotKeys(e)}),onBlur:pt(e.onBlur,function(){return t.disableHotKeys(e)}),tabIndex:w.option("defaultTabIndex")};return this._shouldBindKeyListeners(e)&&(n.onKeyDown=function(e){return t._delegateEventToManager(e,"handleKeyDown")},n.onKeyPress=function(e){return t._delegateEventToManager(e,"handleKeyPress")},n.onKeyUp=function(e){return t._delegateEventToManager(e,"handleKeyUp")}),n}},{key:"_shouldBindKeyListeners",value:function(e){return!ge(this._getKeyMap(e))||e.root}},{key:"addHotKeys",value:function(e){ft.getInstance().registerComponentMount(this.id,e)}},{key:"enableHotKeys",value:function(e){e.onFocus&&e.onFocus.apply(e,arguments);var t=ft.getFocusOnlyEventStrategy().enableHotKeys(this.id,this._getKeyMap(e),this._getHandlers(e),gt());H(t)||this._focusTreeIdsPush(t),this._setFocused(!0)}},{key:"updateHotKeys",value:function(e){var t=ft.getFocusOnlyEventStrategy();if(t.reregisterKeyMap(this.id,e.keyMap),this._componentIsFocused()&&(e.allowChanges||!w.option("ignoreKeymapAndHandlerChangesByDefault"))){var n=e.keyMap,i=e.handlers;t.updateEnabledHotKeys(this.focusTreeId,this.id,n,i,gt())}}},{key:"disableHotKeys",value:function(e){e.onBlur&&e.onBlur.apply(e,arguments),ft.getFocusOnlyEventStrategy().disableHotKeys(this.focusTreeId,this.id)||this._focusTreeIdsShift(),this._setFocused(!1)}},{key:"removeKeyMap",value:function(e){ft.getFocusOnlyEventStrategy().deregisterKeyMap(this.id),ft.getInstance().registerComponentUnmount(),this.disableHotKeys(e)}},{key:"_componentIsFocused",value:function(){return!0===this._focused}},{key:"_focusTreeIdsPush",value:function(e){this._focusTreeIds.push(e)}},{key:"_focusTreeIdsShift",value:function(){this._focusTreeIds.shift()}},{key:"_setFocused",value:function(e){this._focused=e}},{key:"_delegateEventToManager",value:function(e,t){ft.getFocusOnlyEventStrategy()[t](e,this.focusTreeId,this.id,{ignoreEventsCondition:w.option("ignoreEventsCondition")})&&this._focusTreeIdsShift()}},{key:"_mergeWithOptions",value:function(e,t){return h({},this._hotKeysOptions[e]||{},t[e]||{})}},{key:"_getHandlers",value:function(e){return this._mergeWithOptions("handlers",e)}},{key:"_getKeyMap",value:function(e){return this._mergeWithOptions("keyMap",e)}},{key:"focusTreeId",get:function(){return this._focusTreeIds[0]}}]),i}(),kt={keyMap:n.object,handlers:n.object,onFocus:n.func,onBlur:n.func,allowChanges:n.bool,root:n.bool};function _t(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return P(function(i){var e,t,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return t=e=function(e){function n(e){var t;return u(this,n),(t=m(this,d(n).call(this,e)))._manager=new mt(o,e),t}return y(n,r.PureComponent),l(n,[{key:"componentDidMount",value:function(){this._manager.addHotKeys(this.context.hotKeysParentId)}},{key:"componentDidUpdate",value:function(){this._manager.updateHotKeys(this.props)}},{key:"componentWillUnmount",value:function(){this._manager.removeKeyMap(this.props)}},{key:"render",value:function(){var e=this.props,t=(e.keyMap,e.handlers,e.allowChanges,e.root,p(e,["keyMap","handlers","allowChanges","root"]));return a.createElement(i,c({hotKeys:this._manager.getComponentProps(this.props)},t))}}]),n}(),s(e,"propTypes",kt),t}(e,t),{deprecatedAPI:{contextTypes:{hotKeysParentId:n.number},childContextTypes:{hotKeysParentId:n.number}},newAPI:{contextType:{hotKeysParentId:void 0}}})}var bt=_t(function(e){function t(){return u(this,t),m(this,d(t).apply(this,arguments))}return y(t,r.Component),l(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=e.innerRef,i=e.component,o=p(e,["hotKeys","innerRef","component"]),r=i||w.option("defaultComponent");return a.createElement(r,h({},t,{ref:n},o))}}]),t}());bt.propTypes={innerRef:n.oneOfType([n.object,n.func])};var Et=function(){function r(e){u(this,r),this.id=ft.getGlobalEventStrategy().registerKeyMap(e),this.childContext={globalHotKeysParentId:this.id}}return l(r,null,[{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:w.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:w.option("ignoreEventsCondition")}}}]),l(r,[{key:"addHotKeys",value:function(e,t){var n=e.keyMap,i=e.handlers,o=t.globalHotKeysParentId;ft.getInstance().registerGlobalComponentMount(this.id,o),ft.getGlobalEventStrategy().enableHotKeys(this.id,n,i,r._getComponentOptions(),r._getEventOptions())}},{key:"updateHotKeys",value:function(e){var t=ft.getGlobalEventStrategy();if(t.reregisterKeyMap(this.id,e.keyMap),e.allowChanges||!w.option("ignoreKeymapAndHandlerChangesByDefault")){var n=e.keyMap,i=e.handlers;t.updateEnabledHotKeys(this.id,n,i,r._getComponentOptions(),r._getEventOptions())}}},{key:"removeKeyMap",value:function(){var e=ft.getGlobalEventStrategy();e.deregisterKeyMap(this.id),e.disableHotKeys(this.id),ft.getInstance().registerGlobalComponentUnmount()}}]),r}(),Kt=function(e){function n(e){var t;return u(this,n),(t=m(this,d(n).call(this,e)))._manager=new Et(e.keyMap),t}return y(n,r.Component),l(n,[{key:"render",value:function(){return this.props.children||null}},{key:"componentDidMount",value:function(){this._manager.addHotKeys(this.props,this.context)}},{key:"componentDidUpdate",value:function(){this._manager.updateHotKeys(this.props)}},{key:"componentWillUnmount",value:function(){this._manager.removeKeyMap()}}]),n}();s(Kt,"propTypes",{keyMap:n.object,handlers:n.object,allowChanges:n.bool});var Ct=P(Kt,{deprecatedAPI:{contextTypes:{globalHotKeysParentId:n.number},childContextTypes:{globalHotKeysParentId:n.number}},newAPI:{contextType:{globalHotKeysParentId:void 0}}}),St=function(){function t(e){u(this,t),this._handleKeyEvent=this._handleKeyEvent.bind(this),this._eventManagerMethod=e}return l(t,[{key:"getComponentProps",value:function(e){var t=this;return{onKeyDown:this._handleKeyEvent,onKeyPress:this._handleKeyEvent,onKeyUp:this._handleKeyEvent,onFocus:function(){return t._reloadDictionaries(e())}}}},{key:"_reloadDictionaries",value:function(e){var t=e.only,n=e.except;this._onlyDict=It(t),this._exceptDict=It(n)}},{key:"_handleKeyEvent",value:function(e){this._shouldIgnoreEvent(e)&&ft.getInstance()[this._eventManagerMethod](e)}},{key:"_shouldIgnoreEvent",value:function(e){var t=e.key;return ge(this._onlyDict)?!!ge(this._exceptDict)||!D(this._exceptDict,t):ge(this._exceptDict)?D(this._onlyDict,t):D(this._onlyDict,t)&&!D(this._exceptDict,t)}}]),t}();function It(e){return b(e).reduce(function(e,t){var n=V(t);if(!X(n))throw new Z(t);return K([ae,J,F,j,se,re],!0,function(e){return e(n)},e),e},{})}var wt={only:n.oneOfType([n.string,n.arrayOf(n.string)]),except:n.oneOfType([n.string,n.arrayOf(n.string)])};function Pt(i){var e,t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},o=2<arguments.length?arguments[2]:void 0;return t=e=function(e){function n(e){var t;return u(this,n),(t=m(this,d(n).call(this,e)))._manager=new St(o),t}return y(n,r.PureComponent),l(n,[{key:"render",value:function(){var e=this,t=this.props,n=(t.only,t.except,p(t,["only","except"]));return a.createElement(i,c({hotKeys:this._manager.getComponentProps(function(){return e.props})},n))}}]),n}(),s(e,"propTypes",wt),s(e,"defaultProps",n),t}function Ht(e){var t,n;return n=t=function(e){function t(){return u(this,t),m(this,d(t).apply(this,arguments))}return y(t,r.Component),l(t,[{key:"render",value:function(){var e=this.props,t=e.hotKeys,n=p(e,["hotKeys"]),i=n.component||w.option("defaultComponent");return a.createElement(i,h({},t,n))}}]),t}(),s(t,"displayName",e),n}var Tt=Pt(Ht("IgnoreKeys"),{},"ignoreEvent"),Mt=Pt(Ht("ObserveKeys"),{},"observeIgnoredEvents");e.HotKeys=bt,e.GlobalHotKeys=Ct,e.IgnoreKeys=Tt,e.ObserveKeys=Mt,e.withHotKeys=_t,e.withIgnoreKeys=function(e){return Pt(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"ignoreEvent")},e.withObserveKeys=function(e){return Pt(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},"observeIgnoredEvents")},e.configure=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};w.init(e)},e.getApplicationKeyMap=function(){return ft.getInstance().applicationKeyMap},e.recordKeyCombination=function(e){return ft.getInstance().addKeyCombinationListener(e)},Object.defineProperty(e,"__esModule",{value:!0})});
